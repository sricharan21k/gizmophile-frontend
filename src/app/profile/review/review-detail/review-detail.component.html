<!-- Toast -->
<div
  *ngIf="ratingChanged"
  class="fixed top-15 z-50 start-1/2 -translate-x-1/2 max-w-xs text-center bg-white border border-gray-200 rounded-xl shadow-lg"
  role="alert"
>
  <div class="flex p-4">
    <div class="flex-shrink-0">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-6 h-6"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M15.182 15.182a4.5 4.5 0 0 1-6.364 0M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Z"
        />
      </svg>
    </div>
    <div class="ms-3">
      <p class="text-sm text-gray-700">Rating updated!</p>
    </div>
  </div>
</div>

<div class="bg-gray-50">
  <div class="w-2/3 mx-auto">
    <div class="flex items-center gap-x-4 mx-4 p-4 bg-white rounded-lg">
      <a
        class="inline-flex items-center text-gray-800 hover:text-gray-600 hover:bg-gray-100 p-1 rounded-full"
        routerLink="/profile/reviews"
      >
        <svg
          class="flex-shrink-0 size-4"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          class="size-6"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="m15 18-6-6 6-6" />
        </svg>
      </a>
      <div class="text-2xl text-gray-700 font-medium">Review</div>

      <div class="ms-auto grid grid-cols-2 gap-x-4">
        <div
          (click)="editReview()"
          type="button"
          class="py-2 px-4 text-sm text-center text-gray-600 font-semibold rounded-lg border border-transparent bg-gray-100 hover:bg-gray-200 cursor-pointer"
          data-hs-overlay="#hs-scroll-inside-viewport-modal"
        >
          Edit review
        </div>

        <div
          type="button"
          class="py-2 px-4 text-sm text-white font-semibold rounded-lg border border-transparent bg-gray-600 hover:bg-gray-700 cursor-pointer"
          (click)="openDeleteModal()"
        >
          Delete review
        </div>
      </div>
    </div>
  </div>

  <div class="w-2/3 mx-auto p-4">
    <div class="px-4 bg-white flex flex-row items-center rounded-lg">
      <div class="p-4" *ngIf="dataLoaded">
        <img [src]="review?.product?.productImage" alt="" class="h-32" />
      </div>
      <div class="mx-2 text-xl font-semibold text-gray-700">
        {{ review?.product?.productName }}
        <div class="text-base text-gray-500">
          {{ review?.product?.productColor }},
          {{ review?.product?.productVariant }}
        </div>
      </div>

      <div class="ms-auto flex flex-row items-center gap-x-2 px-4">
        <div class="text-4xl text-gray-700 mx-2">
          {{ rating }}
        </div>
        <div
          class="ms-auto flex flex-row-reverse items-center gap-x-0.5 justify-end text-lg"
        >
          <input
            (change)="updateRating(5)"
            id="hs-ratings-1"
            type="radio"
            class="-ms-5 size-5 bg-transparent border-0 text-transparent cursor-pointer appearance-none checked:bg-none focus:bg-none focus:ring-0 focus:ring-offset-0"
          />
          <label
            for="hs-ratings-1"
            class="text-gray-300"
            [ngClass]="{ 'text-gray-700': rating === 5 }"
          >
            <svg
              class="flex-shrink-0 size-5"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              class="size-6"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"
              />
            </svg>
          </label>
          <input
            (change)="updateRating(4)"
            id="hs-ratings-2"
            type="radio"
            class="-ms-5 size-5 bg-transparent border-0 text-transparent cursor-pointer appearance-none checked:bg-none focus:bg-none focus:ring-0 focus:ring-offset-0"
          />
          <label
            for="hs-ratings-2"
            class="text-gray-300"
            [ngClass]="{ 'text-gray-700': rating >= 4 }"
          >
            <svg
              class="flex-shrink-0 size-5"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              class="size-6"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"
              />
            </svg>
          </label>
          <input
            (change)="updateRating(3)"
            id="hs-ratings-3"
            type="radio"
            class="-ms-5 size-5 bg-transparent border-0 text-transparent cursor-pointer appearance-none checked:bg-none focus:bg-none focus:ring-0 focus:ring-offset-0"
          />
          <label
            for="hs-ratings-3"
            class="text-gray-300"
            [ngClass]="{ 'text-gray-700': rating >= 3 }"
          >
            <svg
              class="flex-shrink-0 size-5"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              class="size-6"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"
              />
            </svg>
          </label>
          <input
            (change)="updateRating(2)"
            id="hs-ratings-4"
            type="radio"
            class="-ms-5 size-5 bg-transparent border-0 text-transparent cursor-pointer appearance-none checked:bg-none focus:bg-none focus:ring-0 focus:ring-offset-0"
          />
          <label
            for="hs-ratings-4"
            class="text-gray-300"
            [ngClass]="{ 'text-gray-700': rating >= 2 }"
          >
            <svg
              class="flex-shrink-0 size-5"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              class="size-6"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"
              />
            </svg>
          </label>
          <input
            (change)="updateRating(1)"
            id="hs-ratings-5"
            type="radio"
            class="-ms-5 size-5 bg-transparent border-0 text-transparent cursor-pointer appearance-none checked:bg-none focus:bg-none focus:ring-0 focus:ring-offset-0"
          />
          <label
            for="hs-ratings-5"
            class="text-gray-300"
            [ngClass]="{ 'text-gray-700': rating >= 1 }"
          >
            <svg
              class="flex-shrink-0 size-5"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              class="size-6"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"
              />
            </svg>
          </label>
        </div>
      </div>
    </div>
  </div>
  <div class="w-2/3 mx-auto px-4">
    <div class="p-4 bg-white rounded-lg">
      <div class="mb-4 text-sm text-gray-600">
        Posted {{ review?.posted | date : "dd/MM/yy hh:mm:ss a" }}
        <div *ngIf="review?.lastUpdated">
          Last updated {{ review?.lastUpdated | date : "dd/MM/yy hh:mm:ss a" }}
        </div>
      </div>
      <div class="my-4 flex flex-wrap gap-2">
        <div
          *ngFor="let highlight of review?.highlights"
          class="text-sm bg-gray-100 rounded p-2"
        >
          {{ highlight }}
        </div>
      </div>
      <div class="my-4">
        {{ review?.content }}
      </div>

      <div>
        <label class="block">
          <span class="sr-only">Choose profile photo</span>
          <input
            (change)="uploadImages($event)"
            type="file"
            class="block w-full text-sm text-gray-500 file:me-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-gray-600 file:text-white hover:file:bg-gray-700 file:disabled:opacity-50 file:disabled:pointer-events-none"
            multiple
          />
        </label>
      </div>

      <div class="p-4">
        <div *ngIf="imageGallery.length" class="relative">
          <img [src]="getImage()" alt="" class="h-80 mx-auto" />
          <button
            (click)="previousImage()"
            [disabled]="firstImage"
            type="button"
            class="disabled:opacity-50 disabled:pointer-events-none absolute inset-y-0 start-0 inline-flex justify-center items-center w-[46px] h-full text-gray-800 hover:bg-gray-800/[.1]"
          >
            <span class="text-2xl" aria-hidden="true">
              <svg
                class="size-4"
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="currentColor"
                viewBox="0 0 16 16"
              >
                <path
                  fill-rule="evenodd"
                  d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"
                />
              </svg>
            </span>
            <span class="sr-only">Previous</span>
          </button>
          <button
            (click)="nextImage()"
            [disabled]="lastImage"
            type="button"
            class="disabled:opacity-50 disabled:pointer-events-none absolute inset-y-0 end-0 inline-flex justify-center items-center w-[46px] h-full text-gray-800 hover:bg-gray-800/[.1]"
          >
            <span class="sr-only">Next</span>
            <span class="text-2xl" aria-hidden="true">
              <svg
                class="size-4"
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="currentColor"
                viewBox="0 0 16 16"
              >
                <path
                  fill-rule="evenodd"
                  d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"
                />
              </svg>
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="w-2/3 mx-auto p-4">
    <div class="p-4 bg-white rounded-lg">
      <div class="flex flex-row items-center gap-x-8">
        <div>
          <span>Replies</span>
          <span class="mx-2">{{ review?.replies }}</span>
        </div>
        <div>
          <span>Likes</span>
          <span class="mx-2">{{ review?.likes }}</span>
        </div>
      </div>
      <hr class="my-2" />
      <div *ngFor="let reply of replies" class="my-4">
        <div class="flex items-center">
          <div class="p-5 bg-gray-200 rounded-full"></div>
          <div class="ms-6">
            <div class="text-xl">{{ reply?.profile?.username }}</div>
            <div class="text-xs text-gray-500">
              Last updated: {{ reply?.lastUpdated }}
            </div>
          </div>
        </div>
        <div class="w-3/4 mx-auto border-b">{{ reply.content }}</div>
      </div>
    </div>
  </div>
</div>

<!-- Edit modal -->
<div
  *ngIf="showEditModal"
  id="edit-modal"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center overflow-y-auto px-4 py-6 z-[100]"
>
  <div
    class="bg-white rounded-lg shadow-lg flex flex-col w-full max-w-4xl max-h-full"
  >
    <!-- Modal Header -->
    <div class="px-6 py-4 border-b border-gray-200">
      <div class="flex justify-between items-center">
        <h3 class="text-lg font-medium text-gray-900">Modal Title</h3>
        <button
          class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-full text-sm p-1.5"
          (click)="closeEditModal()"
        >
          <svg
            class="w-5 h-5"
            fill="currentColor"
            viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
              clip-rule="evenodd"
            ></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Modal Body -->
    <div class="flex-1 overflow-y-auto p-6">
      <div>Highlights</div>
      <div class="p-4 flex flex-wrap gap-4 border rounded">
        <button
          (click)="removeHighlight(highlight)"
          *ngFor="let highlight of review?.highlights"
          class="text-sm p-2 bg-gray-100 rounded"
        >
          {{ highlight }}
        </button>
      </div>
      <div class="grid grid-cols-4 gap-4 my-4 p-4 bg-gray-50 rounded-lg">
        <button
          (click)="addHighlight(highlight)"
          *ngFor="let highlight of otherHighlights"
          class="text-sm p-2 text-nowrap bg-gray-100 rounded"
        >
          {{ highlight }}
        </button>
      </div>
      <div>
        <div>Content</div>
        <div>
          <textarea
            [(ngModel)]="content"
            class="py-3 px-4 block w-full border-gray-200 rounded-lg text-sm focus:border-gray-500 focus:ring-gray-500 disabled:opacity-50 disabled:pointer-events-none"
            rows="3"
            placeholder="This is a textarea placeholder"
            >{{ review?.content }}</textarea
          >
        </div>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="px-6 py-4 border-t border-gray-200">
      <div class="flex justify-end space-x-2">
        <button
          class="px-4 py-2 bg-transparent rounded-lg text-gray-500 hover:bg-gray-100 hover:text-gray-400"
          (click)="closeEditModal()"
        >
          Close
        </button>
        <button
          (click)="updateReview()"
          class="px-4 py-2 bg-gray-500 rounded-lg hover:bg-gray-400"
        >
          Post review
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Delete modal -->
<div
  *ngIf="showDeleteModal"
  id="delete-modal"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center overflow-y-auto px-4 py-6 z-[100]"
>
  <div
    class="bg-white rounded-lg shadow-lg flex flex-col w-full max-w-4xl max-h-full"
  >
    <!-- Modal Header -->
    <div class="px-6 py-4 border-b border-gray-200">
      <div class="flex justify-between items-center">
        <h3 class="text-lg font-medium text-gray-900">Modal Title</h3>
        <button
          class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-full text-sm p-1.5"
          (click)="closeDeleteModal()"
        >
          <svg
            class="w-5 h-5"
            fill="currentColor"
            viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
              clip-rule="evenodd"
            ></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Modal Body -->
    <div class="flex-1 overflow-y-auto p-6">
      <p class="mt-1 text-gray-800">
        Do you really want to delete this review?
      </p>
    </div>

    <!-- Modal Footer -->
    <div class="px-6 py-4 border-t border-gray-200">
      <div class="flex justify-end space-x-2">
        <button
          class="px-4 py-2 bg-transparent rounded-lg text-gray-500 hover:bg-gray-100 hover:text-gray-400"
          (click)="closeDeleteModal()"
        >
          Close
        </button>
        <button
          (click)="deleteReview()"
          type="button"
          class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-gray-600 text-white hover:bg-gray-700 disabled:opacity-50 disabled:pointer-events-none"
        >
          Delete
        </button>
      </div>
    </div>
  </div>
</div>
